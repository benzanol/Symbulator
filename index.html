<!DOCTYPE html>
<html>
    <style>
     .flex {
         display: flex;
     }

     #page-container {
         color: black;
         display: flex;
         height: 95vh;
     }

     #equation-container {
         width: 40%;
         max-width: 400px;
     }

     .mathquill {
         font-size: 28px;
         margin: 10px;
     }

     .mq-root-block {
         margin: 50px;
     }

     .delete-equation-button {
         background-color: transparent;
         border: none;
         cursor: pointer;
         overflow: hidden;
         outline: none;
         margin-top: 20px;
         font-size: 14px;
     }

     .add-equation-button {
     }

     #graph-container {
         position: relative;
         margin: 3%;
         height: 90%;
         width: 90%;
     }

     .graph-canvas {
         position: absolute;
         width: 100%;
         height: 100%;
         top: 0px;
         left: 0px;
     }

     .vertical-line {
         background-color: gray;
         width: 1px;
     }
    </style>

    <head>
        <!-- Automatically refresh browser when filesystem changes -->
        <meta charset="UTF-8">
        <title>ScalaJS Calculator!</title>
    </head>

    <body>
        <div id="page-container">
            <div id="equation-container">
                <button onclick="addEquation()" class="add-equation-button">Add Equation</button>
                <br>
                <div id="equations">
                </div>
            </div>
            <div class="vertical-line"></div>

            <div id="graph-container">
                <canvas class="graph-canvas" id="graph-grid"
                        style="background-color: transparent;" style="z-index: 0;">
                </canvas>
                <canvas class="graph-canvas" id="graph-functions"
                        style="background-color: transparent;" style="z-index: 1;">
                </canvas>
            </div>
        </div>
    </body>

    <!-- Mathquill -->
    <script src="./node_modules/jquery/dist/jquery.min.js"></script>

    <link rel="stylesheet" href="./node_modules/mathquill/build/mathquill.css"/>
    <script src="./node_modules/mathquill/build/mathquill.min.js"></script>

    <!-- Evaluatex -->
    <script src="./node_modules/evaluatex/dist/evaluatex.min.js"></script>

    <script type="module">
     //import ./node_modules/evaluatex/dist/lexer.js
     //lexer("x + 1", {x: 1}, {})
    </script>

    <script>
     const MQ = MathQuill.getInterface(2);

     function formatEquations() {
         var spans = [...document.getElementsByClassName('mathquill')];

         for (let i = 0; i < spans.length; i++) {
             MQ.MathField(spans[i], {
                 handlers: { edit: (field) => updateFunctions() }
             });
         }
     }

     function focusEquation(id) {
         MQ(document.getElementById(id)).focus();
     }

     function getLatexEquations() {
         let elements = document.getElementsByClassName("mathquill");
         var latexes = [];

         for (var i = 0; i < elements.length; i++) {
             latexes.push(MQ(elements[i]).latex());
         }

         return latexes
     }

     function getFunctions() {
         let eqns = document.getElementsByClassName("mathquill");
         var functions = [];

         for (var i = 0; i < eqns.length; i++) {
             let latex = MQ(eqns[i]).latex();
             try {
                 let parsed = evaluatex(latex, {latex: true})
                 let func = (arg) => parsed({x: arg})
                 functions.push(func);
             } catch (error) {}
         }

         return functions;
     }

     // This is never actually used, since the javascript function can be
     // called natively from within scala
     function getPoints(start, end, inc) {
         let funcs = getFunctions()
         var pointses = []

         funcs.map((f) => {
             var points = [];
             for (var x = start; x <= end; x += inc) {
                 try {
                     points.push(f(x));
                 } catch (error) {}
             }
             pointses.push(points);
         });

         return pointses
     }
    </script>

    <!-- Scala.js code -->
    <script type="text/javascript" src="./js/main.js"></script>

</html>
